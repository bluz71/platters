<% cache "artists_sidebar", expires_in: 5.minutes do %>
  <aside id="artists-sidebar" class="col-lg-2">
    <section class="card">
      <div class="card-header">
        <h4 class="card-title">New Albums</h4>
      </div>
      <div class="new-albums list-group list-group-flush">
        <% Album.with_relations.most_recent.each do |album| %>
          <div class="album list-group-item">
            <h5><%= link_to album.title, [album.artist, album] %></h5>
            <h5>by <%= link_to album.artist.name, album.artist %></h5>
            <%= link_to [album.artist, album] do %>
              <%= image_tag(album.cover.small.url, class: "img-fluid mx-auto d-block") if album.cover? %>
            <% end %>
          </div>
        <% end %>
      </div>
    </section>

    <section class="card">
      <div class="card-header">
        <h4 class="card-title">New Comments</h4>
      </div>
      <div class="new-comments list-group list-group-flush">
        <% Comment.most_recent.each do |comment| %>
          <div class="comment list-group-item">
            <h5>
              <%= local_time_ago comment.created_at %> by
            </h5>
            <h5><%= link_to comment.user.name, user_comments_path(comment.user.slug) %></h5>
            <%= link_to user_comments_path(comment.user.slug) do %>
              <%= image_tag(gravatar_url(comment.user), class: "img-fluid mx-auto d-block") %>
            <% end %>
            <h5>
              in <%= link_to commentable_name(comment), commentable_path(comment) %>
            </h5>
          </div>
        <% end %>
      </div>
    </section>
  </aside>
<% end %>
